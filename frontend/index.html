<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DisasterAlert</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-start py-12 min-h-screen">

<div class="w-full max-w-lg bg-white p-6 rounded-xl shadow-lg">

  <h2 class="text-3xl font-bold text-center text-blue-600 mb-6">DisasterAlert</h2>

  <!-- Form Section -->
  <div class="form-section mb-10">
    <h3 class="text-xl font-semibold text-center text-gray-700 mb-4">Report Emergency</h3>

    <input id="title" placeholder="Title" class="w-full p-3 mb-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
    <div id="title-error" class="text-red-500 text-sm mb-2 hidden">Invalid Title</div>

    <textarea id="description" placeholder="Description" class="w-full p-3 mb-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 h-24 resize-none"></textarea>
    <div id="description-error" class="text-red-500 text-sm mb-2 hidden">Invalid Description</div>

    <input id="location" placeholder="Location" class="w-full p-3 mb-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
    <div id="location-error" class="text-red-500 text-sm mb-2 hidden">Invalid Location</div>

    <select id="category" class="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
      <option>Fire</option>
      <option>Flood</option>
      <option>Accident</option>
      <option>Electricity</option>
    </select>

    <button onclick="reportEmergency()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors">Report Emergency</button>
  </div>

  <!-- Dashboard Section -->
  <div class="dashboard-section">
    <h3 class="text-xl font-semibold text-gray-700 mb-4 text-center">All Emergencies</h3>
    <div id="admin-list" class="space-y-4"></div>
  </div>
</div>

<script>
const API_URL = "http://localhost:3000/api";

function isValidText(input) {
  return /^[a-zA-Z\s]+$/.test(input.trim());
}

function isValidLocation(input) {
  const trimmed = input.trim();
  if (trimmed.length < 3) return false;
  return /^[a-zA-Z0-9\s,]+$/.test(trimmed);
}

async function reportEmergency() {
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  const location = document.getElementById("location").value;
  const category = document.getElementById("category").value;

  document.getElementById("title-error").classList.add("hidden");
  document.getElementById("description-error").classList.add("hidden");
  document.getElementById("location-error").classList.add("hidden");

  let valid = true;
  if (!isValidText(title)) { document.getElementById("title-error").classList.remove("hidden"); valid = false; }
  if (!isValidText(description)) { document.getElementById("description-error").classList.remove("hidden"); valid = false; }
  if (!isValidLocation(location)) { document.getElementById("location-error").classList.remove("hidden"); valid = false; }

  if (!valid) return;

  const res = await fetch(`${API_URL}/emergencies`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, description, location, category })
  });

  const data = await res.json();
  alert(data.message || "Emergency reported!");
  loadEmergencies();

  document.getElementById("title").value = "";
  document.getElementById("description").value = "";
  document.getElementById("location").value = "";
}

async function loadEmergencies() {
  const res = await fetch(`${API_URL}/emergencies`);
  const emergencies = await res.json();

  const container = document.getElementById("admin-list");
  container.innerHTML = "";

  emergencies.forEach(e => {
    const div = document.createElement("div");
    div.className = "bg-gray-50 p-4 rounded-lg shadow hover:scale-105 transition-transform";
    div.innerHTML = `
      <h4 class="text-lg font-semibold text-blue-600 mb-1">${e.title}</h4>
      <p class="text-gray-700 mb-1">${e.description}</p>
      <p class="text-gray-500 mb-1"><span class="font-semibold">Location:</span> ${e.location}</p>
      <p class="text-gray-500 mb-1"><span class="font-semibold">Category:</span> ${e.category}</p>
      <p class="text-gray-500 mb-2"><span class="font-semibold">Status:</span> ${e.status}</p>
      <div class="flex gap-2 flex-wrap">
        <button onclick="updateStatus(${e.id},'Verified')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded transition-colors">Verified</button>
        <button onclick="updateStatus(${e.id},'In Progress')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded transition-colors">In Progress</button>
        <button onclick="updateStatus(${e.id},'Resolved')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded transition-colors">Resolved</button>
      </div>
    `;
    container.appendChild(div);
  });
}

async function updateStatus(id, status) {
  await fetch(`${API_URL}/emergencies/${id}/status`, {
    method: "PATCH",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status })
  });
  loadEmergencies();
}

window.onload = loadEmergencies;
</script>

</body>
</html>
